{"version":3,"file":"cart.js","sources":["../src/cart.js"],"sourcesContent":["//Логіка сторінки Cart\n\nimport { refs } from './js/refs';\nimport * as storage from './js/storage';\nimport * as api from './js/products-api';\nimport { hideNotFound,openProductModal,showNotFound,setCartChangeHandler} from './js/handlers';\nimport {\n  renderProducts,\n  renderModalProduct,\n  updateNavCount,\n} from './js/render-function';\nimport { openModal } from './js/modal';\nimport { toastSuccess, toggleTheme, toastInfo, toastError } from './js/helpers';\n\n\nlet pageProducts = [];\n\nexport async function initCartPage() {\n  updateNavCount();\n  const saved = storage.getTheme();\n  toggleTheme(saved);\n  const ids = storage.getCart();\n  if (!ids || ids.length === 0) {\n    if (refs.notFound) refs.notFound.classList.add('not-found--visible');\n    refs.productsList.innerHTML = '';\n    pageProducts = [];\n    updateSummary(0, 0);\n    return;\n  }\n\n  try {\n    refs.notFound?.classList.remove('not-found--visible');\n    const promises = ids.map(id => api.getProductById(id));\n    const products = await Promise.all(promises);\n    pageProducts = products;\n    refs.productsList.innerHTML = '';\n    renderProducts(products);\n    const total = products.reduce((s, p) => s + (p.price || 0), 0);\n    updateSummary(products.length, total);\n  } catch (err) {\n    console.error(err);\n  }\n}\n\nfunction searchInPageProducts(query) {\n  const q = query.toLowerCase();\n\n  return pageProducts.filter(product => {\n    const titleMatch = product.title?.toLowerCase().includes(q);\n    const categoryMatch = product.category?.toLowerCase().includes(q);\n    const tagsMatch = product.tags?.some(tag => tag.toLowerCase().includes(q));\n\n    return titleMatch || categoryMatch || tagsMatch;\n  });\n}\n\nexport function searchSubmitHandlerLocal(e) {\n  e.preventDefault();\n\n  const query = refs.searchInput.value.trim();\n\n  if (!query || \"\") {\n    toastError('Please, enter text');\n    return;\n  }\n\n  refs.searchClearBtn.classList.remove('hidden');\n\n  const filtered = searchInPageProducts(query);\n\n  refs.productsList.innerHTML = '';\n\n  if (filtered.length === 0) {\n    showNotFound();\n    return;\n  }\n\n  hideNotFound();\n  renderProducts(filtered);\n}\nexport function searchClearHandlerLocal() {\n  refs.searchInput.value = '';\n  refs.searchClearBtn.classList.add('hidden');\n\n  hideNotFound();\n  refs.productsList.innerHTML = '';\n  renderProducts(pageProducts);\n}\n\nsetCartChangeHandler(() => {\n  initCartPage();\n});\n\nrefs.searchForm?.addEventListener('submit', searchSubmitHandlerLocal);\nrefs.searchClearBtn?.addEventListener('click', searchClearHandlerLocal);\n\nfunction updateSummary(items, total) {\n  if (refs.cartItemsCount) refs.cartItemsCount.textContent = items;\n  if (refs.cartTotal)\n    refs.cartTotal.textContent = `$${Number(total).toFixed(2)};`;\n}\n\nrefs.themeToggleBtn?.addEventListener('click', () => {\n  const next = document.body.dataset.theme === 'dark' ? 'light' : 'dark';\n  toggleTheme(next);\n  saveTheme(next);\n});\n\nrefs.productsList?.addEventListener('click', async e => {\n  const li = e.target.closest('.products__item');\n  if (!li) return;\n  const id = li.dataset.id;\n  const product = await api.getProductById(id);\n  openProductModal(Number(li.dataset.id));\n\n  renderModalProduct(product);\n  openModal();\n  const wishlistBtn = refs.modal.querySelector('.modal-product__btn--wishlist');\n  const cartBtn = refs.modal.querySelector('.modal-product__btn--cart');\n\n  if (wishlistBtn) {\n    wishlistBtn.onclick = () => {\n      if (storage.isInWishlist(id)) {\n        storage.removeFromWishlist(id);\n        wishlistBtn.textContent = 'Add to Wishlist';\n        toastInfo('Removed from wishlist');\n      } else {\n        storage.addToWishlist(id);\n        wishlistBtn.textContent = 'Remove from Wishlist';\n      }\n      updateNavCount();\n    };\n  }\n  if (cartBtn) {\n    cartBtn.onclick = () => {\n      if (storage.isInCart(id)) {\n        storage.removeFromCart(id);\n        cartBtn.textContent = 'Add to Cart';\n      } else {\n        storage.addToCart(id);\n        cartBtn.textContent = 'Remove from Cart';\n      }\n      updateNavCount();\n      initCartPage();\n    };\n  }\n});\n\nrefs.buyProductsBtn?.addEventListener('click', () => {\n  const cart = storage.getCart();\n\n  if (!cart || cart.length === 0) {\n    toastInfo('Cart empty, please add product');\n    return;\n  }\n\n  storage.saveToLS('cart', []);\n  toastSuccess('Thank you! Your order has been placed.');\n  refs.notFound.classList.add('not-found--visible');\n  refs.productsList.innerHTML = '';\n  updateNavCount();\n  updateSummary(0, 0);\n});\n\ndocument.addEventListener('DOMContentLoaded', initCartPage);\n"],"names":["pageProducts","initCartPage","updateNavCount","saved","storage.getTheme","toggleTheme","ids","storage.getCart","refs","updateSummary","promises","id","api.getProductById","products","renderProducts","total","s","p","err","searchInPageProducts","query","q","product","titleMatch","categoryMatch","tagsMatch","tag","searchSubmitHandlerLocal","e","toastError","filtered","showNotFound","hideNotFound","searchClearHandlerLocal","setCartChangeHandler","items","next","li","openProductModal","renderModalProduct","openModal","wishlistBtn","cartBtn","storage.isInWishlist","storage.removeFromWishlist","toastInfo","storage.addToWishlist","storage.isInCart","storage.removeFromCart","storage.addToCart","cart","storage.saveToLS","toastSuccess"],"mappings":"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"}