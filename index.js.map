{"version":3,"file":"index.js","sources":["../src/js/handlers.js","../src/home.js"],"sourcesContent":["import * as api from './products-api';\nimport { refs } from './refs';\nimport {\n  renderCategories,\n  renderProducts,\n  renderModalProduct,\n  updateNavCount,\n} from './render-function';\nimport {\n  showLoader,\n  hideLoader,\n  toastError,\n  toastSuccess,\n  toastInfo,\n  clearActiveCategory,\n} from './helpers';\nimport * as storage from './storage';\nimport { openModal, closeModal } from './modal';\nimport { ITEMS_PER_PAGE } from './constants';\n\nlet currentPage = 1;\nlet currentCategory = 'All';\nlet currentQuery = '';\nlet totalProducts = 0;\n\nexport async function initHomePage() {\n  try {\n    showLoader();\n    const categories = await api.getCategories();\n    renderCategories(categories);\n    currentPage = 1;\n    const { products } = await api.getProducts();\n    renderProducts(products);\n    await loadProducts({ reset: true });\n    updateNavCount();\n    if (refs.searchClearBtn) refs.searchClearBtn.classList.add('hidden');\n  } catch (err) {\n    console.error(err);\n    toastError('Failed to initialize home page');\n  } finally {\n    hideLoader();\n  }\n}\n\nexport async function loadProducts({ reset = false } = {}) {\n  try {\n    if (reset) currentPage = 1;\n    showLoader();\n    let resp;\n    if (currentQuery) {\n      resp = await api.searchProducts(currentQuery, currentPage);\n    } else if (currentCategory && currentCategory !== 'All') {\n      resp = await api.getProductsByCategory(currentCategory, currentPage);\n    } else {\n      resp = await api.getProducts(currentPage);\n    }\n    const products = resp.products || [];\n    totalProducts = resp.total ?? products.length;\n    if (!products.length) {\n      refs.productsList.innerHTML = '';\n      if (refs.notFound) refs.notFound.classList.add('not-found--visible');\n      if (refs.loadMoreBtn) refs.loadMoreBtn.classList.add('hidden');\n      return;\n    } else {\n      if (refs.notFound) refs.notFound.classList.remove('not-found--visible');\n    }\n    const append = !reset && currentPage > 1;\n    renderProducts(products, { append });\n    const loaded = (currentPage - 1) * ITEMS_PER_PAGE + products.length;\n    if (loaded >= totalProducts) {\n      if (refs.loadMoreBtn) refs.loadMoreBtn.classList.add('hidden');\n      toastInfo('No more products to load');\n    } else {\n      if (refs.loadMoreBtn) refs.loadMoreBtn.classList.remove('hidden');\n    }\n  } catch (err) {\n    console.error(err);\n    toastError('Failed to load products');\n  } finally {\n    hideLoader();\n  }\n}\n\nexport function categoriesClickHandler(e) {\n  const btn = e.target.closest('.categories__btn');\n  if (!btn) return;\n\n  refs.searchInput.value = '';\n  const category = btn.textContent.trim();\n\n  currentCategory = category;\n  currentQuery = '';\n  currentPage = 1;\n\n  const allBtns = refs.categoriesList.querySelectorAll('.categories__btn');\n  allBtns.forEach(b =>\n    b.classList.toggle('categories__btn--active', b === btn)\n  );\n  loadProducts({ reset: true });\n\n  if (category === 'All') {\n    loadProductsAll();\n  } else {\n    loadProductsByCategory(category);\n  }\n}\n\nasync function loadProductsAll() {\n  try {\n    const { products } = await api.getProducts(currentPage);\n    checkFound(products);\n    refs.productsList.innerHTML = '';\n    renderProducts(products);\n  } catch (err) {\n    console.error(err);\n  }\n}\n\nasync function loadProductsByCategory(category) {\n  try {\n    const { products } = await api.getProductsByCategory(category, currentPage);\n    checkFound(products);\n\n    refs.productsList.innerHTML = '';\n    renderProducts(products);\n  } catch (err) {\n    console.error(err);\n  }\n}\n\nfunction checkFound(products) {\n  if (!products || products.length === 0) {\n    refs.notFound.classList.add('not-found--visible');\n  } else {\n    refs.notFound.classList.remove('not-found--visible');\n  }\n}\n\nexport async function productsClickHandler(e) {\n  const li = e.target.closest('.products__item');\n  if (!li) return;\n\n  const id = li.dataset.id;\n  if (!id) return;\n\n  try {\n    showLoader();\n    const product = await api.getProductById(id);\n    renderModalProduct(product);\n    openModal();\n    attachModalButtons(product.id);\n  } catch (err) {\n    console.error(err);\n    toastError('Failed to load product details');\n  } finally {\n    hideLoader();\n  }\n}\n\nfunction attachModalButtons(productId) {\n  const wishlistBtn = refs.modal.querySelector('.modal-product__wishlist-btn');\n  const cartBtn = refs.modal.querySelector('.modal-product__cart-btn');\n  const buyBtn = refs.modal.querySelector('.modal-product__buy-btn');\n\n  if (wishlistBtn) {\n    wishlistBtn.onclick = () => {\n      if (storage.isInWishlist(productId)) {\n        storage.removeFromWishlist(productId);\n        wishlistBtn.textContent = 'Add to Wishlist';\n        toastInfo('Removed from wishlist');\n      } else {\n        storage.addToWishlist(productId);\n        wishlistBtn.textContent = 'Remove from Wishlist';\n        toastSuccess('Added to wishlist');\n      }\n      updateNavCount();\n    };\n  }\n\n  if (cartBtn) {\n    cartBtn.onclick = () => {\n      if (storage.isInCart(productId)) {\n        storage.removeFromCart(productId);\n        cartBtn.textContent = 'Add to Cart';\n        toastInfo('Removed from cart');\n      } else {\n        storage.addToCart(productId);\n        cartBtn.textContent = 'Remove from Cart';\n        toastSuccess('Added to cart');\n      }\n      updateNavCount();\n    };\n  }\n\n  if (buyBtn) {\n    buyBtn.onclick = () => {\n      if (window.iziToast)\n        iziToast.success({ title: 'Success', message: 'Purchase complete' });\n    };\n  }\n}\n\nexport function loadMoreHandler() {\n  currentPage += 1;\n  loadProducts({ reset: false });\n}\n\nexport async function searchSubmitHandler(e) {\n  e.preventDefault();\n\n  const query = refs.searchInput.value.trim();\n\n  if (!query) return;\nrefs.searchClearBtn.classList.remove('hidden');\n  clearActiveCategory();\n\n  currentQuery = query;\n  currentPage = 1;\n  \n  try {\n    const { products } = await api.searchProducts(query, currentPage);\n\n    refs.productsList.innerHTML = '';\n\n    const q = query.toLowerCase();\n\n    const filtered = products.filter(product => {\n      const titleMatch = product.title.toLowerCase().includes(q);\n      const categoryMatch = product.category.toLowerCase().includes(q);\n      const tagsMatch = product.tags?.some(tag =>\n        tag.toLowerCase().includes(q)\n      );\n      return titleMatch || categoryMatch || tagsMatch;\n    });\n\n    if (filtered.length === 0) {\n      showNotFound();\n      return;\n    }\n\n    hideNotFound();\n    renderProducts(filtered);\n  } catch (err) {\n    console.log(err);\n  }\n}\n\nfunction showNotFound() {\n  refs.notFound.classList.add('not-found--visible');\n}\n\nfunction hideNotFound() {\n  refs.notFound.classList.remove('not-found--visible');\n}\n\nexport async function onSearchClear() {\n  refs.searchInput.addEventListener('input', () => {\n    if (refs.searchInput.value.trim()) {\n      refs.searchClearBtn.classList.remove('hidden');\n    } else {\n      refs.searchClearBtn.classList.add('hidden');\n    }\n  });\n\n  refs.searchClearBtn.addEventListener('click', () => {\n    refs.searchInput.value = '';\n    refs.searchClearBtn.classList.add('hidden');\n\n    currentCategory = 'All';\n    currentQuery = '';\n    currentPage = 1;\n\n    loadProducts({ reset: true }); \n  });\n  \n}\n\nexport function initScrollUp() {\n  if (!refs.scrollUpBtn) return;\n  window.addEventListener('scroll', () => {\n    if (window.scrollY > 300) refs.scrollUpBtn.classList.remove('hidden');\n    else refs.scrollUpBtn.classList.add('hidden');\n  });\n  refs.scrollUpBtn.addEventListener('click', () =>\n    window.scrollTo({ top: 0, behavior: 'smooth' })\n  );\n}\n","//Логіка сторінки Home\n\nimport {\n  initHomePage,\n  categoriesClickHandler,\n  productsClickHandler,\n  loadMoreHandler,\n  searchSubmitHandler,\n  onSearchClear,\n  initScrollUp,\n} from './js/handlers';\nimport { refs } from './js/refs';\nimport { toggleTheme } from './js/helpers';\nimport { getTheme, saveTheme } from './js/storage';\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  const saved = getTheme();\n  toggleTheme(saved);\n  initHomePage();\n\n  refs.categoriesList?.addEventListener('click', categoriesClickHandler);\n  refs.productsList?.addEventListener('click', productsClickHandler);\n  refs.loadMoreBtn?.addEventListener('click', loadMoreHandler);\n  refs.searchForm?.addEventListener('submit', searchSubmitHandler);\n  refs.searchClearBtn?.addEventListener('click', onSearchClear);\n\n  refs.themeToggleBtn?.addEventListener('click', () => {\n    const next = document.body.dataset.theme === 'dark' ? 'light' : 'dark';\n    toggleTheme(next);\n    saveTheme(next);\n  });\n\n  initScrollUp();\n});\n\n\n\n\n\n\n\n\n\n\n// import { initHomePage, categoriesClickHandler,searchClearBtn,searchSubmitHandler} from './js/handlers';\n// import { refs } from './js/refs';\n// import { toggleTheme } from './js/helpers';\n// import { getTheme, saveTheme } from './js/storage';\n// import { renderCategories, renderProducts } from './js/render-function';\n// import { getCategories,getProductById,getProducts,searchProducts } from './js/products-api';\n\n\n// document.addEventListener('DOMContentLoaded', initHomePage);\n\n// document.addEventListener('DOMContentLoaded', () => {\n//   const saved = getTheme();\n//   toggleTheme(saved);\n\n//   refs.themeToggleBtn?.addEventListener('click', () => {\n//     const next = document.body.dataset.theme === 'dark' ? 'light' : 'dark';\n//     toggleTheme(next);\n//     saveTheme(next);\n//   });\n// });\n\n// refs.categoriesList.addEventListener('click', categoriesClickHandler);\n// refs.productsList.addEventListener('click', productClickHandler);\n// refs.searchForm.addEventListener('submit', searchSubmitHandler);\n// refs.searchClearBtn.addEventListener('click', searchClearBtn);\n\n// refs.searchInput.addEventListener('input', () => {\n//   if (refs.searchInput.value.trim()) {\n//     refs.searchClearBtn.classList.add('visible');\n//   } else {\n//     refs.searchClearBtn.classList.remove('visible');\n//   }\n// });"],"names":["currentPage","currentCategory","currentQuery","totalProducts","initHomePage","showLoader","categories","api.getCategories","renderCategories","products","api.getProducts","renderProducts","loadProducts","updateNavCount","refs","err","toastError","hideLoader","reset","resp","api.searchProducts","api.getProductsByCategory","append","ITEMS_PER_PAGE","toastInfo","categoriesClickHandler","e","btn","category","b","loadProductsAll","loadProductsByCategory","checkFound","productsClickHandler","li","id","product","api.getProductById","renderModalProduct","openModal","attachModalButtons","productId","wishlistBtn","cartBtn","buyBtn","storage.isInWishlist","storage.removeFromWishlist","storage.addToWishlist","toastSuccess","storage.isInCart","storage.removeFromCart","storage.addToCart","loadMoreHandler","searchSubmitHandler","query","clearActiveCategory","q","filtered","titleMatch","categoryMatch","tagsMatch","tag","showNotFound","hideNotFound","onSearchClear","initScrollUp","saved","getTheme","toggleTheme","next","saveTheme"],"mappings":"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"}