{"version":3,"file":"index.js","sources":["../src/js/handlers.js","../src/home.js"],"sourcesContent":["import * as api from './products-api';\nimport { refs } from './refs';\nimport {\n  renderCategories,\n  renderProducts,\n  renderModalProduct,\n  updateNavCount,\n} from './render-function';\nimport {\n  showLoader,\n  hideLoader,\n  toastError,\n  toastSuccess,\n  toastInfo,\n  clearActiveCategory,\n} from './helpers';\nimport * as storage from './storage';\nimport { openModal, closeModal } from './modal';\nimport { ITEMS_PER_PAGE } from './constants';\n\nlet currentPage = 1;\nlet currentCategory = 'All';\nlet currentQuery = '';\nlet totalProducts = 0;\n\n\nexport async function initHomePage() {\n  try {\n    showLoader();\n    const categories = await api.getCategories();\n    renderCategories(categories);\n    currentPage = 1;\n    await loadProducts({ reset: true });\n    updateNavCount();\n    if (refs.searchClearBtn) refs.searchClearBtn.classList.add('hidden');\n  } catch (err) {\n    console.error(err);\n    toastError('Failed to initialize home page');\n  } finally {\n    hideLoader();\n  }\n}\n\nexport async function loadProducts({ reset = false } = {}) {\n  try {\n    if (reset) currentPage = 1;\n    showLoader();\n    let resp;\n    if (currentQuery) {\n      resp = await api.searchProducts(currentQuery, currentPage);\n    } else if (currentCategory && currentCategory !== 'All') {\n      resp = await api.getProductsByCategory(currentCategory, currentPage);\n    } else {\n      resp = await api.getProducts(currentPage);\n    }\n    const products = resp.products || [];\n    totalProducts = resp.total ?? products.length;\n    if (!products.length) {\n      refs.productsList.innerHTML = '';\n      if (refs.notFound) refs.notFound.classList.add('not-found--visible');\n      if (refs.loadMoreBtn) refs.loadMoreBtn.classList.add('is-hidden');\n      return;\n    } else {\n      if (refs.notFound) refs.notFound.classList.remove('not-found--visible');\n    }\n    const append = !reset && currentPage > 1;\n    renderProducts(products, { append });\n    const loaded = (currentPage - 1) * ITEMS_PER_PAGE + products.length;\n    if (loaded >= totalProducts) {\n      if (refs.loadMoreBtn) refs.loadMoreBtn.classList.add('is-hidden');\n      toastInfo('No more products to load');\n    } else {\n      if (refs.loadMoreBtn) refs.loadMoreBtn.classList.remove('is-hidden');\n    }\n  } catch (err) {\n    console.error(err);\n    toastError('Failed to load products');\n  } finally {\n    hideLoader();\n  }\n}\n\nexport function categoriesClickHandler(e) {\n  const btn = e.target.closest('.categories__btn');\n  if (!btn) return;\n\n  refs.searchInput.value = '';\n  const category = btn.textContent.trim();\n\n  currentCategory = category;\n  currentQuery = '';\n  currentPage = 1;\n\n  const allBtns = refs.categoriesList.querySelectorAll('.categories__btn');\n  allBtns.forEach(b =>\n    b.classList.toggle('categories__btn--active', b === btn)\n  );\n  loadProducts({ reset: true });\n\n  if (category === 'All') {\n    loadProductsAll();\n  } else {\n    loadProductsByCategory(category);\n  }\n}\n\nasync function loadProductsAll() {\n  try {\n    const { products } = await api.getProducts(currentPage);\n    checkFound(products);\n    refs.productsList.innerHTML = '';\n    renderProducts(products);\n  } catch (err) {\n    console.error(err);\n  }\n}\n\nasync function loadProductsByCategory(category) {\n  try {\n    const { products } = await api.getProductsByCategory(category, currentPage);\n    checkFound(products);\n\n    refs.productsList.innerHTML = '';\n    renderProducts(products);\n  } catch (err) {\n    console.error(err);\n  }\n}\n\nfunction checkFound(products) {\n  if (!products || products.length === 0) {\n    refs.notFound.classList.add('not-found--visible');\n  } else {\n    refs.notFound.classList.remove('not-found--visible');\n  }\n}\n\nexport async function productsClickHandler(e) {\n  const li = e.target.closest('.products__item');\n  if (!li) return;\n\n  const id = li.dataset.id;\n  if (!id) return;\n\n  try {\n    showLoader();\n    const product = await api.getProductById(id);\n    renderModalProduct(product);\n    openModal();\n    attachModalButtons(product.id);\n  } catch (err) {\n    console.error(err);\n    toastError('Failed to load product details');\n  } finally {\n    hideLoader();\n  }\n}\n\nfunction attachModalButtons(productId) {\n  const wishlistBtn = refs.modal.querySelector('.modal-product__wishlist-btn');\n  const cartBtn = refs.modal.querySelector('.modal-product__cart-btn');\n  const buyBtn = refs.modal.querySelector('.modal-product__buy-btn');\n\n  if (wishlistBtn) {\n    wishlistBtn.onclick = () => {\n      if (storage.isInWishlist(productId)) {\n        storage.removeFromWishlist(productId);\n        wishlistBtn.textContent = 'Add to Wishlist';\n        toastInfo('Removed from wishlist');\n      } else {\n        storage.addToWishlist(productId);\n        wishlistBtn.textContent = 'Remove from Wishlist';\n        toastSuccess('Added to wishlist');\n      }\n      updateNavCount();\n    };\n  }\n\n  if (cartBtn) {\n    cartBtn.onclick = () => {\n      if (storage.isInCart(productId)) {\n        storage.removeFromCart(productId);\n        cartBtn.textContent = 'Add to Cart';\n        toastInfo('Removed from cart');\n      } else {\n        storage.addToCart(productId);\n        cartBtn.textContent = 'Remove from Cart';\n        toastSuccess('Added to cart');\n      }\n      updateNavCount();\n    };\n  }\n\n  if (buyBtn) {\n    buyBtn.onclick = () => {\n      if (window.iziToast)\n        iziToast.success({ title: 'Success', message: 'Purchase complete' });\n    };\n  }\n}\n\nexport function loadMoreHandler() {\n  currentPage += 1;\n  loadProducts({ reset: false });\n}\n\nexport async function searchSubmitHandler(e) {\n  e.preventDefault();\n\n  const query = refs.searchInput.value.trim();\n\n  if (!query) return;\n  refs.searchClearBtn.classList.remove('hidden');\n  clearActiveCategory();\n\n  currentQuery = query;\n  currentPage = 1;\n\n  try {\n    showLoader();\n    const { products } = await api.searchAllProducts(query, currentPage);\n\n    refs.productsList.innerHTML = '';\n\n    const q = query.toLowerCase();\n\n    const filtered = products.filter(product => {\n      const titleMatch = product.title.toLowerCase().includes(q);\n      const categoryMatch = product.category.toLowerCase().includes(q);\n      const tagsMatch = product.tags?.some(tag =>\n        tag.toLowerCase().includes(q)\n      );\n      return titleMatch || categoryMatch || tagsMatch;\n    });\n\n    if (filtered.length === 0) {\n      showNotFound();\n      return;\n    }\n\n    hideNotFound();\n    renderProducts(filtered);\n    hideLoader();\n  } catch (err) {\n    console.log(err);\n  }\n}\n\nfunction showNotFound() {\n  refs.notFound.classList.add('not-found--visible');\n}\n\nfunction hideNotFound() {\n  refs.notFound.classList.remove('not-found--visible');\n}\n\nexport async function onSearchClear() {\n  refs.searchInput.addEventListener('input', () => {\n    if (refs.searchInput.value.trim()) {\n      refs.searchClearBtn.classList.remove('hidden');\n    } else {\n      refs.searchClearBtn.classList.add('hidden');\n    }\n  });\n\n  refs.searchClearBtn.addEventListener('click', () => {\n    refs.searchInput.value = '';\n    refs.searchClearBtn.classList.add('hidden');\n\n    currentCategory = 'All';\n    currentQuery = '';\n    currentPage = 1;\n\n    loadProducts({ reset: true });\n  });\n}\n\nexport function initScrollUp() {\n  if (!refs.scrollUpBtn) return;\n  window.addEventListener('scroll', () => {\n    if (window.scrollY > 300) {\n      refs.scrollUpBtn.classList.add('scroll-top-btn--visible');\n    } else {\n      refs.scrollUpBtn.classList.remove('scroll-top-btn--visible');\n    }\n  });\n  refs.scrollUpBtn.addEventListener('click', () =>\n    window.scrollTo({ top: 0, behavior: 'smooth' })\n  );\n}\n","//Логіка сторінки Home\n\nimport {\n  initHomePage,\n  categoriesClickHandler,\n  productsClickHandler,\n  loadMoreHandler,\n  searchSubmitHandler,\n  onSearchClear,\n  initScrollUp,\n} from './js/handlers';\nimport { refs } from './js/refs';\nimport { toggleTheme } from './js/helpers';\nimport { getTheme, saveTheme } from './js/storage';\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  const saved = getTheme();\n  toggleTheme(saved);\n  initHomePage();\n  \n\n  refs.categoriesList?.addEventListener('click', categoriesClickHandler);\n  refs.productsList?.addEventListener('click', productsClickHandler);\n  refs.loadMoreBtn?.addEventListener('click', loadMoreHandler);\n  refs.searchForm?.addEventListener('submit', searchSubmitHandler);\n  refs.searchClearBtn?.addEventListener('click', onSearchClear);\n\n  refs.themeToggleBtn?.addEventListener('click', () => {\n    const next = document.body.dataset.theme === 'dark' ? 'light' : 'dark';\n    toggleTheme(next);\n    saveTheme(next);\n  });\n\n  initScrollUp();\n});\n\n\n\n\n\n\n\n\n\n\n// import { initHomePage, categoriesClickHandler,searchClearBtn,searchSubmitHandler} from './js/handlers';\n// import { refs } from './js/refs';\n// import { toggleTheme } from './js/helpers';\n// import { getTheme, saveTheme } from './js/storage';\n// import { renderCategories, renderProducts } from './js/render-function';\n// import { getCategories,getProductById,getProducts,searchProducts } from './js/products-api';\n\n\n// document.addEventListener('DOMContentLoaded', initHomePage);\n\n// document.addEventListener('DOMContentLoaded', () => {\n//   const saved = getTheme();\n//   toggleTheme(saved);\n\n//   refs.themeToggleBtn?.addEventListener('click', () => {\n//     const next = document.body.dataset.theme === 'dark' ? 'light' : 'dark';\n//     toggleTheme(next);\n//     saveTheme(next);\n//   });\n// });\n\n// refs.categoriesList.addEventListener('click', categoriesClickHandler);\n// refs.productsList.addEventListener('click', productClickHandler);\n// refs.searchForm.addEventListener('submit', searchSubmitHandler);\n// refs.searchClearBtn.addEventListener('click', searchClearBtn);\n\n// refs.searchInput.addEventListener('input', () => {\n//   if (refs.searchInput.value.trim()) {\n//     refs.searchClearBtn.classList.add('visible');\n//   } else {\n//     refs.searchClearBtn.classList.remove('visible');\n//   }\n// });"],"names":["currentPage","currentCategory","currentQuery","totalProducts","initHomePage","showLoader","categories","api.getCategories","renderCategories","loadProducts","updateNavCount","refs","err","toastError","hideLoader","reset","resp","api.searchProducts","api.getProductsByCategory","api.getProducts","products","append","renderProducts","ITEMS_PER_PAGE","toastInfo","categoriesClickHandler","e","btn","category","b","loadProductsAll","loadProductsByCategory","checkFound","productsClickHandler","li","id","product","api.getProductById","renderModalProduct","openModal","attachModalButtons","productId","wishlistBtn","cartBtn","buyBtn","storage.isInWishlist","storage.removeFromWishlist","storage.addToWishlist","toastSuccess","storage.isInCart","storage.removeFromCart","storage.addToCart","loadMoreHandler","searchSubmitHandler","query","clearActiveCategory","api.searchAllProducts","q","filtered","titleMatch","categoryMatch","tagsMatch","tag","showNotFound","hideNotFound","onSearchClear","initScrollUp","saved","getTheme","toggleTheme","next","saveTheme"],"mappings":"kRAoBA,IAAIA,EAAc,EACdC,EAAkB,MAClBC,EAAe,GACfC,EAAgB,EAGb,eAAeC,GAAe,CACnC,GAAI,CACFC,EAAU,EACV,MAAMC,EAAa,MAAMC,EAAiB,EAC1CC,EAAiBF,CAAU,EAC3BN,EAAc,EACd,MAAMS,EAAa,CAAE,MAAO,GAAM,EAClCC,EAAc,EACVC,EAAK,gBAAgBA,EAAK,eAAe,UAAU,IAAI,QAAQ,CACrE,OAASC,EAAK,CACZ,QAAQ,MAAMA,CAAG,EACjBC,EAAW,gCAAgC,CAC7C,QAAC,CACCC,EAAU,CACZ,CACF,CAEO,eAAeL,EAAa,CAAE,MAAAM,EAAQ,EAAK,EAAK,CAAA,EAAI,CACzD,GAAI,CACEA,IAAOf,EAAc,GACzBK,EAAU,EACV,IAAIW,EACAd,EACFc,EAAO,MAAMC,EAAmBf,EAAcF,CAAW,EAChDC,GAAmBA,IAAoB,MAChDe,EAAO,MAAME,EAA0BjB,EAAiBD,CAAW,EAEnEgB,EAAO,MAAMG,EAAgBnB,CAAW,EAE1C,MAAMoB,EAAWJ,EAAK,UAAY,CAAA,EAElC,GADAb,EAAgBa,EAAK,OAASI,EAAS,OAClCA,EAAS,OAMRT,EAAK,UAAUA,EAAK,SAAS,UAAU,OAAO,oBAAoB,MANlD,CACpBA,EAAK,aAAa,UAAY,GAC1BA,EAAK,UAAUA,EAAK,SAAS,UAAU,IAAI,oBAAoB,EAC/DA,EAAK,aAAaA,EAAK,YAAY,UAAU,IAAI,WAAW,EAChE,MACF,CAGA,MAAMU,EAAS,CAACN,GAASf,EAAc,EACvCsB,EAAeF,EAAU,CAAE,OAAAC,EAAQ,GACnBrB,EAAc,GAAKuB,EAAiBH,EAAS,QAC/CjB,GACRQ,EAAK,aAAaA,EAAK,YAAY,UAAU,IAAI,WAAW,EAChEa,EAAU,0BAA0B,GAEhCb,EAAK,aAAaA,EAAK,YAAY,UAAU,OAAO,WAAW,CAEvE,OAASC,EAAK,CACZ,QAAQ,MAAMA,CAAG,EACjBC,EAAW,yBAAyB,CACtC,QAAC,CACCC,EAAU,CACZ,CACF,CAEO,SAASW,EAAuBC,EAAG,CACxC,MAAMC,EAAMD,EAAE,OAAO,QAAQ,kBAAkB,EAC/C,GAAI,CAACC,EAAK,OAEVhB,EAAK,YAAY,MAAQ,GACzB,MAAMiB,EAAWD,EAAI,YAAY,KAAI,EAErC1B,EAAkB2B,EAClB1B,EAAe,GACfF,EAAc,EAEEW,EAAK,eAAe,iBAAiB,kBAAkB,EAC/D,QAAQkB,GACdA,EAAE,UAAU,OAAO,0BAA2BA,IAAMF,CAAG,CAC3D,EACElB,EAAa,CAAE,MAAO,GAAM,EAExBmB,IAAa,MACfE,EAAe,EAEfC,EAAuBH,CAAQ,CAEnC,CAEA,eAAeE,GAAkB,CAC/B,GAAI,CACF,KAAM,CAAE,SAAAV,CAAQ,EAAK,MAAMD,EAAgBnB,CAAW,EACtDgC,EAAWZ,CAAQ,EACnBT,EAAK,aAAa,UAAY,GAC9BW,EAAeF,CAAQ,CACzB,OAASR,EAAK,CACZ,QAAQ,MAAMA,CAAG,CACnB,CACF,CAEA,eAAemB,EAAuBH,EAAU,CAC9C,GAAI,CACF,KAAM,CAAE,SAAAR,CAAQ,EAAK,MAAMF,EAA0BU,EAAU5B,CAAW,EAC1EgC,EAAWZ,CAAQ,EAEnBT,EAAK,aAAa,UAAY,GAC9BW,EAAeF,CAAQ,CACzB,OAASR,EAAK,CACZ,QAAQ,MAAMA,CAAG,CACnB,CACF,CAEA,SAASoB,EAAWZ,EAAU,CACxB,CAACA,GAAYA,EAAS,SAAW,EACnCT,EAAK,SAAS,UAAU,IAAI,oBAAoB,EAEhDA,EAAK,SAAS,UAAU,OAAO,oBAAoB,CAEvD,CAEO,eAAesB,EAAqBP,EAAG,CAC5C,MAAMQ,EAAKR,EAAE,OAAO,QAAQ,iBAAiB,EAC7C,GAAI,CAACQ,EAAI,OAET,MAAMC,EAAKD,EAAG,QAAQ,GACtB,GAAKC,EAEL,GAAI,CACF9B,EAAU,EACV,MAAM+B,EAAU,MAAMC,EAAmBF,CAAE,EAC3CG,EAAmBF,CAAO,EAC1BG,EAAS,EACTC,EAAmBJ,EAAQ,EAAE,CAC/B,OAASxB,EAAK,CACZ,QAAQ,MAAMA,CAAG,EACjBC,EAAW,gCAAgC,CAC7C,QAAC,CACCC,EAAU,CACZ,CACF,CAEA,SAAS0B,EAAmBC,EAAW,CACrC,MAAMC,EAAc/B,EAAK,MAAM,cAAc,8BAA8B,EACrEgC,EAAUhC,EAAK,MAAM,cAAc,0BAA0B,EAC7DiC,EAASjC,EAAK,MAAM,cAAc,yBAAyB,EAE7D+B,IACFA,EAAY,QAAU,IAAM,CACtBG,EAAqBJ,CAAS,GAChCK,EAA2BL,CAAS,EACpCC,EAAY,YAAc,kBAC1BlB,EAAU,uBAAuB,IAEjCuB,EAAsBN,CAAS,EAC/BC,EAAY,YAAc,uBAC1BM,EAAa,mBAAmB,GAElCtC,EAAc,CAChB,GAGEiC,IACFA,EAAQ,QAAU,IAAM,CAClBM,EAAiBR,CAAS,GAC5BS,EAAuBT,CAAS,EAChCE,EAAQ,YAAc,cACtBnB,EAAU,mBAAmB,IAE7B2B,EAAkBV,CAAS,EAC3BE,EAAQ,YAAc,mBACtBK,EAAa,eAAe,GAE9BtC,EAAc,CAChB,GAGEkC,IACFA,EAAO,QAAU,IAAM,CACjB,OAAO,UACT,SAAS,QAAQ,CAAE,MAAO,UAAW,QAAS,oBAAqB,CACvE,EAEJ,CAEO,SAASQ,GAAkB,CAChCpD,GAAe,EACfS,EAAa,CAAE,MAAO,GAAO,CAC/B,CAEO,eAAe4C,EAAoB3B,EAAG,CAC3CA,EAAE,eAAc,EAEhB,MAAM4B,EAAQ3C,EAAK,YAAY,MAAM,KAAI,EAEzC,GAAK2C,EACL,CAAA3C,EAAK,eAAe,UAAU,OAAO,QAAQ,EAC7C4C,EAAmB,EAEnBrD,EAAeoD,EACftD,EAAc,EAEd,GAAI,CACFK,EAAU,EACV,KAAM,CAAE,SAAAe,CAAQ,EAAK,MAAMoC,EAAsBF,EAAOtD,CAAW,EAEnEW,EAAK,aAAa,UAAY,GAE9B,MAAM8C,EAAIH,EAAM,YAAW,EAErBI,EAAWtC,EAAS,OAAOgB,GAAW,CAC1C,MAAMuB,EAAavB,EAAQ,MAAM,YAAW,EAAG,SAASqB,CAAC,EACnDG,EAAgBxB,EAAQ,SAAS,YAAW,EAAG,SAASqB,CAAC,EACzDI,EAAYzB,EAAQ,MAAM,KAAK0B,GACnCA,EAAI,cAAc,SAASL,CAAC,CACpC,EACM,OAAOE,GAAcC,GAAiBC,CACxC,CAAC,EAED,GAAIH,EAAS,SAAW,EAAG,CACzBK,EAAY,EACZ,MACF,CAEAC,EAAY,EACZ1C,EAAeoC,CAAQ,EACvB5C,EAAU,CACZ,OAASF,EAAK,CACZ,QAAQ,IAAIA,CAAG,CACjB,EACF,CAEA,SAASmD,GAAe,CACtBpD,EAAK,SAAS,UAAU,IAAI,oBAAoB,CAClD,CAEA,SAASqD,GAAe,CACtBrD,EAAK,SAAS,UAAU,OAAO,oBAAoB,CACrD,CAEO,eAAesD,IAAgB,CACpCtD,EAAK,YAAY,iBAAiB,QAAS,IAAM,CAC3CA,EAAK,YAAY,MAAM,KAAI,EAC7BA,EAAK,eAAe,UAAU,OAAO,QAAQ,EAE7CA,EAAK,eAAe,UAAU,IAAI,QAAQ,CAE9C,CAAC,EAEDA,EAAK,eAAe,iBAAiB,QAAS,IAAM,CAClDA,EAAK,YAAY,MAAQ,GACzBA,EAAK,eAAe,UAAU,IAAI,QAAQ,EAE1CV,EAAkB,MAClBC,EAAe,GACfF,EAAc,EAEdS,EAAa,CAAE,MAAO,GAAM,CAC9B,CAAC,CACH,CAEO,SAASyD,IAAe,CACxBvD,EAAK,cACV,OAAO,iBAAiB,SAAU,IAAM,CAClC,OAAO,QAAU,IACnBA,EAAK,YAAY,UAAU,IAAI,yBAAyB,EAExDA,EAAK,YAAY,UAAU,OAAO,yBAAyB,CAE/D,CAAC,EACDA,EAAK,YAAY,iBAAiB,QAAS,IACzC,OAAO,SAAS,CAAE,IAAK,EAAG,SAAU,QAAQ,CAAE,CAClD,EACA,CClRA,SAAS,iBAAiB,mBAAoB,IAAM,CAClD,MAAMwD,EAAQC,EAAQ,EACtBC,EAAYF,CAAK,EACjB/D,EAAY,EAGZO,EAAK,gBAAgB,iBAAiB,QAASc,CAAsB,EACrEd,EAAK,cAAc,iBAAiB,QAASsB,CAAoB,EACjEtB,EAAK,aAAa,iBAAiB,QAASyC,CAAe,EAC3DzC,EAAK,YAAY,iBAAiB,SAAU0C,CAAmB,EAC/D1C,EAAK,gBAAgB,iBAAiB,QAASsD,EAAa,EAE5DtD,EAAK,gBAAgB,iBAAiB,QAAS,IAAM,CACnD,MAAM2D,EAAO,SAAS,KAAK,QAAQ,QAAU,OAAS,QAAU,OAChED,EAAYC,CAAI,EAChBC,EAAUD,CAAI,CAChB,CAAC,EAEDJ,GAAY,CACd,CAAC"}